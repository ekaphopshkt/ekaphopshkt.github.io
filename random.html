<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Analysis Simulator</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for Thai characters -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #1a1a2e;
            color: #e0e0e0;
        }
        .container {
            max-width: 960px;
        }
        .card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer;
            background-color: #2a2a47;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .profit-text {
            color: #10b981; /* green-500 */
        }
        .loss-text {
            color: #ef4444; /* red-500 */
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3b82f6;
            width: 24px;
            height: 24px;
            -webkit-animation: spin 2s linear infinite;
            animation: spin 2s linear infinite;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Custom animation for the price pulse effect */
        @keyframes pulse-light-up {
            0%, 100% { box-shadow: 0 0 8px rgba(16, 185, 129, 0.5); }
            50% { box-shadow: 0 0 20px rgba(16, 185, 129, 1); }
        }
        @keyframes pulse-light-down {
            0%, 100% { box-shadow: 0 0 8px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 20px rgba(239, 68, 68, 1); }
        }
        .price-pulse-up { animation: pulse-light-up 2s infinite; }
        .price-pulse-down { animation: pulse-light-down 2s infinite; }
        .bg-gradient-header {
            background-image: linear-gradient(to right, #4c51bf, #6b46c1);
        }
    </style>
</head>
<body class="p-4 sm:p-8">
    <div class="container mx-auto bg-[#1a1a2e] rounded-xl shadow-lg">
        <div class="bg-gradient-header rounded-t-xl p-6 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-white mb-2">เครื่องมือจำลองการวิเคราะห์คริปโต</h1>
            <p class="text-sm sm:text-base text-gray-200">
                <span class="font-bold text-yellow-300">คำเตือน:</span> ข้อมูลราคาปัจจุบันเป็นแบบ Real-time แต่การวิเคราะห์และราคาแนะนำเป็นการจำลองเพื่อการสาธิตเท่านั้น ไม่ใช่คำแนะนำทางการเงิน
            </p>
        </div>
        
        <div class="p-6 sm:p-10">
            <div class="flex flex-col sm:flex-row items-center justify-center mb-6 space-y-4 sm:space-y-0 sm:space-x-4">
                <button onclick="runAnalysis()" class="bg-indigo-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 flex items-center">
                    <span id="buttonText">Scan หาเหรียญน่าซื้อ</span>
                    <div id="loader" class="hidden ml-2 loader"></div>
                </button>
            </div>
            
            <p id="lastUpdated" class="text-center text-gray-400 text-sm mb-6">ยังไม่มีข้อมูล</p>

            <div id="resultsContainer" class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Simulated crypto cards will be injected here by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Simulated Top 1000 coins on Binance.th with base prices and volumes
        const mockCryptoData = [
            { symbol: 'BTC', name: 'Bitcoin', basePrice: 65000, volume: 'very-high' },
            { symbol: 'ETH', name: 'Ethereum', basePrice: 3800, volume: 'very-high' },
            { symbol: 'BNB', name: 'Binance Coin', basePrice: 600, volume: 'high' },
            { symbol: 'SOL', name: 'Solana', basePrice: 150, volume: 'high' },
            { symbol: 'XRP', name: 'Ripple', basePrice: 0.50, volume: 'medium' },
            { symbol: 'ADA', name: 'Cardano', basePrice: 0.45, volume: 'medium' },
            { symbol: 'DOGE', name: 'Dogecoin', basePrice: 0.12, volume: 'medium' },
            { symbol: 'SHIB', name: 'Shiba Inu', basePrice: 0.000025, volume: 'high' },
            { symbol: 'DOT', name: 'Polkadot', basePrice: 7.00, volume: 'medium' },
            { symbol: 'LINK', name: 'Chainlink', basePrice: 18.00, volume: 'high' },
            { symbol: 'MATIC', name: 'Polygon', basePrice: 0.75, volume: 'high' },
            { symbol: 'AVAX', name: 'Avalanche', basePrice: 28.00, volume: 'medium' },
            { symbol: 'LTC', name: 'Litecoin', basePrice: 75.00, volume: 'medium' },
            { symbol: 'BCH', name: 'Bitcoin Cash', basePrice: 400.00, volume: 'medium' },
            { symbol: 'ETC', name: 'Ethereum Classic', basePrice: 30.00, volume: 'low' },
            { symbol: 'UNI', name: 'Uniswap', basePrice: 10.00, volume: 'medium' },
            { symbol: 'FIL', name: 'Filecoin', basePrice: 5.50, volume: 'low' },
            { symbol: 'TRX', name: 'TRON', basePrice: 0.11, volume: 'medium' },
            { symbol: 'XLM', name: 'Stellar', basePrice: 0.10, volume: 'low' },
            { symbol: 'VET', name: 'VeChain', basePrice: 0.025, volume: 'low' },
            { symbol: 'CAKE', name: 'PancakeSwap', basePrice: 2.50, volume: 'low' },
            { symbol: 'XMR', name: 'Monero', basePrice: 150.00, volume: 'low' },
            { symbol: 'ATOM', name: 'Cosmos', basePrice: 8.50, volume: 'medium' },
            { symbol: 'ALGO', name: 'Algorand', basePrice: 0.18, volume: 'low' },
            { symbol: 'AAVE', name: 'Aave', basePrice: 80.00, volume: 'low' },
            { symbol: 'EOS', name: 'EOS', basePrice: 0.85, volume: 'low' },
            { symbol: 'ZEC', name: 'Zcash', basePrice: 25.00, volume: 'low' },
            { symbol: 'COMP', name: 'Compound', basePrice: 50.00, volume: 'low' },
            { symbol: 'MKR', name: 'Maker', basePrice: 2500.00, volume: 'low' },
            { symbol: 'DASH', name: 'Dash', basePrice: 30.00, volume: 'low' },
            { symbol: 'NEO', name: 'Neo', basePrice: 15.00, volume: 'low' },
            { symbol: 'KSM', name: 'Kusama', basePrice: 35.00, volume: 'low' },
            { symbol: 'THETA', name: 'Theta Network', basePrice: 1.50, volume: 'low' },
            { symbol: 'SNX', name: 'Synthetix', basePrice: 2.80, volume: 'low' },
            { symbol: 'FTM', name: 'Fantom', basePrice: 0.35, volume: 'low' },
            { symbol: 'ENJ', name: 'Enjin Coin', basePrice: 0.28, volume: 'low' },
            { symbol: 'XTZ', name: 'Tezos', basePrice: 0.80, volume: 'low' },
            { symbol: 'EGLD', name: 'MultiversX', basePrice: 40.00, volume: 'low' },
            { symbol: 'ICX', name: 'ICON', basePrice: 0.22, volume: 'low' },
            { symbol: 'CHZ', name: 'Chiliz', basePrice: 0.10, volume: 'low' },
            { symbol: 'GALA', name: 'Gala', basePrice: 0.02, volume: 'low' },
            { symbol: 'AXS', name: 'Axie Infinity', basePrice: 6.00, volume: 'low' },
            { symbol: 'MANA', name: 'Decentraland', basePrice: 0.38, volume: 'low' },
            { symbol: 'SAND', name: 'The Sandbox', basePrice: 0.45, volume: 'low' },
            { symbol: 'ICP', name: 'Internet Computer', basePrice: 8.00, volume: 'low' },
            { symbol: 'NEAR', name: 'NEAR Protocol', basePrice: 6.00, volume: 'low' },
            { symbol: 'APT', name: 'Aptos', basePrice: 9.00, volume: 'low' },
            { symbol: 'SUI', name: 'Sui', basePrice: 1.20, volume: 'low' },
            // Add more simulated low-price, low-volume coins
            { symbol: 'ARPA', name: 'ARPA Chain', basePrice: 0.05, volume: 'low' },
            { symbol: 'AGIX', name: 'SingularityNET', basePrice: 0.60, volume: 'medium' },
            { symbol: 'FET', name: 'Fetch.ai', basePrice: 1.50, volume: 'medium' },
            { symbol: 'OCEAN', name: 'Ocean Protocol', basePrice: 0.80, volume: 'low' },
            { symbol: 'CELR', name: 'Celer Network', basePrice: 0.02, volume: 'low' },
            { symbol: 'KAVA', name: 'Kava', basePrice: 0.88, volume: 'low' },
            { symbol: 'BAND', name: 'Band Protocol', basePrice: 1.20, volume: 'low' },
            { symbol: 'RLC', name: 'iExec RLC', basePrice: 2.00, volume: 'low' },
            { symbol: 'CTSI', name: 'Cartesi', basePrice: 0.25, volume: 'low' },
            { symbol: 'LINA', name: 'Linear', basePrice: 0.008, volume: 'low' },
            { symbol: 'ONE', name: 'Harmony', basePrice: 0.015, volume: 'low' },
            { symbol: 'CVC', name: 'Civic', basePrice: 0.15, volume: 'low' },
            { symbol: 'DENT', name: 'Dent', basePrice: 0.001, volume: 'low' },
            { symbol: 'REQ', name: 'Request', basePrice: 0.18, volume: 'low' },
            { symbol: 'GTC', name: 'Gitcoin', basePrice: 1.80, volume: 'low' },
            { symbol: 'PHA', name: 'Phala Network', basePrice: 0.12, volume: 'low' },
            { symbol: 'NU', name: 'NuCypher', basePrice: 0.08, volume: 'low' },
            { symbol: 'COTI', name: 'COTI', basePrice: 0.08, volume: 'low' },
            { symbol: 'HBAR', name: 'Hedera', basePrice: 0.07, volume: 'medium' },
            { symbol: 'IOTA', name: 'IOTA', basePrice: 0.20, volume: 'low' },
            { symbol: 'RVN', name: 'Ravencoin', basePrice: 0.02, volume: 'low' },
            { symbol: 'ANKR', name: 'Ankr', basePrice: 0.04, volume: 'low' },
            { symbol: 'CTK', name: 'CertiK', basePrice: 0.65, volume: 'low' },
            { symbol: 'CELO', name: 'Celo', basePrice: 0.70, volume: 'low' },
            { symbol: 'SCRT', name: 'Secret', basePrice: 0.40, volume: 'low' },
            { symbol: 'ROSE', name: 'Oasis Network', basePrice: 0.08, volume: 'low' },
            { symbol: 'SKL', name: 'SKALE', basePrice: 0.05, volume: 'low' },
            { symbol: 'STX', name: 'Stacks', basePrice: 1.80, volume: 'medium' },
            { symbol: 'MASK', name: 'Mask Network', basePrice: 3.50, volume: 'low' },
            { symbol: 'KDA', name: 'Kadena', basePrice: 0.75, volume: 'low' },
            { symbol: 'AUDIO', name: 'Audius', basePrice: 0.18, volume: 'low' },
            { symbol: 'SFP', name: 'SafePal', basePrice: 0.40, volume: 'low' },
            { symbol: 'OGN', name: 'Origin Protocol', basePrice: 0.12, volume: 'low' },
            { symbol: 'JASMY', name: 'JasmyCoin', basePrice: 0.004, volume: 'medium' },
            { symbol: 'ID', name: 'SPACE ID', basePrice: 0.55, volume: 'low' },
            { symbol: 'LDO', name: 'Lido DAO', basePrice: 2.50, volume: 'medium' },
            { symbol: 'OP', name: 'Optimism', basePrice: 2.00, volume: 'high' },
            { symbol: 'ARB', name: 'Arbitrum', basePrice: 1.00, volume: 'high' }
        ];

        // Binance commission rate (0.1% for maker/taker)
        const binanceFeeRate = 0.001;
        const THB_INVESTMENT = 1000;
        const MIN_PROFIT_THB = 40;
        const MAX_THB_PRICE = 10; // Max price for coins to be scanned

        let ws = null; // WebSocket instance
        let usdToThbRate = 35.0; // Default exchange rate, will be fetched
        let analysisData = {}; // Stores the analysis data from a single run

        async function fetchExchangeRate() {
            try {
                // Using a free and reliable currency API to get USD to THB rate
                const response = await fetch('https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/usd.json');
                const data = await response.json();
                if (data && data.usd && data.usd.thb) {
                    usdToThbRate = data.usd.thb;
                }
            } catch (error) {
                console.error("Could not fetch exchange rate, using default.", error);
            }
        }
        
        function showLoader() {
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('buttonText').textContent = 'กำลังสแกน...';
            document.getElementById('lastUpdated').textContent = 'กำลังสแกนหาเหรียญราคาต่ำที่น่าสนใจ...';
            document.getElementById('resultsContainer').innerHTML = '';
        }

        function hideLoader() {
            document.getElementById('loader').classList.add('hidden');
            document.getElementById('buttonText').textContent = 'Scan หาเหรียญน่าซื้อ';
        }

        async function runAnalysis() {
            if (ws) {
                ws.close();
            }
            showLoader();
            
            await fetchExchangeRate();

            // Filter for coins with high volume and low price
            const eligibleCoins = mockCryptoData.filter(coin => 
                coin.basePrice * usdToThbRate < MAX_THB_PRICE && ['high', 'very-high', 'medium', 'low'].includes(coin.volume)
            );
            
            // Simulate a network request delay
            setTimeout(() => {
                hideLoader();
                
                const resultsContainer = document.getElementById('resultsContainer');
                
                if (eligibleCoins.length === 0) {
                     resultsContainer.innerHTML = `<p class="text-center text-lg text-red-500 mt-8">ไม่พบเหรียญที่เข้าเงื่อนไขในขณะนี้</p>`;
                     document.getElementById('lastUpdated').textContent = 'สแกนเสร็จสิ้น';
                     return;
                }
                
                // Select two random eligible coins for the analysis
                const coinToAnalyze = getRandomElements(eligibleCoins, 1);

                resultsContainer.innerHTML = ''; // Clear previous results

                // Generate card for the first (real-time) coin
                const coin1 = coinToAnalyze[0];
                const card1Html = generateCardHtml(coin1, true); // true for real-time
                resultsContainer.innerHTML += card1Html;
                setupWebSocket(coin1.symbol.toLowerCase() + 'usdt', coin1);

                document.getElementById('lastUpdated').textContent = 'สแกนเสร็จสิ้น';

            }, 2000); // 2-second delay to simulate scanning process
        }

        function generateCardHtml(coinData, isRealtime) {
            const priceId = 'realtime-price';
            const buyPriceId = 'buy-price';
            const sellPriceId = 'sell-price';
            const supportPriceId = 'support-price';
            const resistancePriceId = 'resistance-price';
            const netProfitUsdId = 'net-profit-usd';
            const netProfitThbId = 'net-profit-thb';
            const buyChanceId = 'buy-chance';
            const sellChanceId = 'sell-chance';
            const analysisSummaryId = 'analysis-summary';

            return `
                <div class="card p-6 rounded-lg shadow-md border border-[#3e3e57]">
                    <div class="flex items-center mb-4">
                        <span class="text-3xl font-bold text-indigo-400">${coinData.symbol}</span>
                        <span class="ml-2 text-xl font-semibold text-gray-300">${coinData.name}</span>
                        ${!isRealtime ? `<span class="text-xs text-gray-500 ml-2">(ราคาคงที่)</span>` : ''}
                    </div>
                    
                    <div class="space-y-4 text-gray-400">
                        <!-- Current Price Section -->
                        <div class="flex items-center justify-between bg-[#3e3e57] p-4 rounded-lg">
                            <span class="text-xl font-semibold text-gray-200">ราคาปัจจุบัน</span>
                            <span id="${priceId}" class="text-3xl font-bold text-white">กำลังเชื่อมต่อ...</span>
                        </div>

                        <!-- Buy/Sell/Support/Resistance -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="bg-[#3e3e57] p-4 rounded-lg">
                                <p class="font-semibold text-green-400">ราคาแนะนำเข้าซื้อ (15 นาที)</p>
                                <p id="${buyPriceId}" class="text-2xl font-bold text-white">-</p>
                            </div>
                            <div class="bg-[#3e3e57] p-4 rounded-lg">
                                <p class="font-semibold text-red-400">ราคาแนะนำขายทำกำไร (1 วัน)</p>
                                <p id="${sellPriceId}" class="text-2xl font-bold text-white">-</p>
                            </div>
                            <div class="bg-[#3e3e57] p-4 rounded-lg">
                                <p class="font-semibold text-blue-400 flex items-center">
                                    แนวรับ (Support)
                                </p>
                                <p id="${supportPriceId}" class="text-xl font-bold text-white">-</p>
                            </div>
                            <div class="bg-[#3e3e57] p-4 rounded-lg">
                                <p class="font-semibold text-yellow-400 flex items-center">
                                    แนวต้าน (Resistance)
                                </p>
                                <p id="${resistancePriceId}" class="text-xl font-bold text-white">-</p>
                            </div>
                        </div>

                        <!-- Profit and Chance -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div class="bg-[#3e3e57] p-4 rounded-lg">
                                <p class="font-semibold text-gray-300">กำไรที่คาดว่าจะได้ (หลังหักค่าธรรมเนียม)</p>
                                <p>
                                    <span id="${netProfitUsdId}" class="font-bold text-lg">-</span>
                                    <span class="text-sm text-gray-500">(USD)</span>
                                </p>
                                <p>
                                    <span id="${netProfitThbId}" class="font-bold text-lg">-</span>
                                    <span class="text-sm text-gray-500">(THB)</span>
                                </p>
                            </div>
                            <div class="bg-[#3e3e57] p-4 rounded-lg">
                                <p class="font-semibold text-gray-300">โอกาสเข้าซื้อ / ขาย</p>
                                <p id="${buyChanceId}" class="text-sm text-green-400">โอกาสเข้าซื้อ: -</p>
                                <p id="${sellChanceId}" class="text-sm text-red-400 mt-1">โอกาสขายทำกำไร: -</p>
                            </div>
                        </div>

                        <!-- Analysis Summary -->
                        <div class="bg-[#3e3e57] p-4 rounded-lg">
                            <p class="font-bold text-gray-300">การวิเคราะห์เบื้องต้น (จำลอง)</p>
                            <p id="${analysisSummaryId}" class="text-sm text-gray-400 mt-2">-</p>
                        </div>

                    </div>
                </div>
            `;
        }


        // --- Technical Analysis Logic (SIMULATED) ---
        function getSimulatedTechnicalAnalysis(currentPrice) {
            // Simulate a short-term volatility percentage (e.g., 2-8% over 1 day)
            const dailyVolatility = 0.02 + Math.random() * 0.06;
            
            // Simulate a short-term trend (Bullish, Bearish, Sideways)
            const trend = Math.random();
            let trendFactor;
            if (trend < 0.3) trendFactor = -1; // Bearish
            else if (trend > 0.7) trendFactor = 1; // Bullish
            else trendFactor = 0; // Sideways
            
            // Simulated Support and Resistance Calculation
            const simulatedLow = currentPrice * (1 - dailyVolatility);
            const simulatedHigh = currentPrice * (1 + dailyVolatility);
            
            // Adjust support/resistance based on trend
            const support = (trendFactor === 1) ? currentPrice * (1 - (Math.random() * 0.02)) : simulatedLow;
            const resistance = (trendFactor === -1) ? currentPrice * (1 + (Math.random() * 0.02)) : simulatedHigh;

            // Simulated RSI (Relative Strength Index)
            const rsi = 30 + Math.random() * 60;

            // Simulated MACD Status
            const macdStatus = Math.random() > 0.5 ? 'Bullish' : 'Bearish';
            
            return { support, resistance, rsi, macdStatus };
        }
        
        function setupWebSocket(symbol, coinData) {
            ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol}@ticker`);
            let lastPrice = 0;
            const priceElement = document.getElementById('realtime-price');
            const lastUpdatedElement = document.getElementById('lastUpdated');
            let analysisCalculated = false;
            let initialSellPrice = 0;

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                const currentPrice = parseFloat(data.c);
                
                if (priceElement) {
                    if (currentPrice > lastPrice) {
                        priceElement.className = 'text-3xl font-bold text-green-400 price-pulse-up';
                    } else if (currentPrice < lastPrice) {
                        priceElement.className = 'text-3xl font-bold text-red-400 price-pulse-down';
                    } else {
                        priceElement.className = 'text-3xl font-bold text-white';
                    }
                    priceElement.textContent = `$${currentPrice.toFixed(4)}`;
                }
                
                if (lastUpdatedElement) {
                    lastUpdatedElement.textContent = `อัปเดตล่าสุด: ${new Date().toLocaleTimeString('th-TH')}`;
                }

                // Calculate analysis data for the first time
                if (!analysisCalculated) {
                    analysisData = getSimulatedTechnicalAnalysis(currentPrice);
                    
                    const initialInvestmentUSD = THB_INVESTMENT / usdToThbRate;
                    const buyPriceForCalc = currentPrice * 0.97;
                    const amountBought = initialInvestmentUSD / buyPriceForCalc;

                    const targetNetProfitUSD = MIN_PROFIT_THB / usdToThbRate;
                    const requiredGrossProfitUSD = targetNetProfitUSD / (1 - binanceFeeRate);
                    initialSellPrice = (buyPriceForCalc * (1 + binanceFeeRate) + requiredGrossProfitUSD / amountBought) / (1 - binanceFeeRate);
                    
                    analysisData.sellPrice = initialSellPrice;
                    analysisCalculated = true;
                }
                
                // Always update the real-time buy price
                analysisData.buyPrice = currentPrice * 0.97;

                simulateAnalysisAndDisplay(currentPrice, analysisData, coinData.symbol);
                
                lastPrice = currentPrice;
            };

            ws.onerror = (error) => {
                console.error("WebSocket Error:", error);
                if (lastUpdatedElement) {
                    lastUpdatedElement.textContent = 'การเชื่อมต่อผิดพลาด';
                }
            };

            ws.onclose = () => {
                if (lastUpdatedElement) {
                    lastUpdatedElement.textContent = 'การเชื่อมต่อถูกตัด';
                }
            };
        }
        
        function simulateAnalysisAndDisplay(currentPrice, data, symbol) {
            const { support, resistance, rsi, macdStatus, buyPrice, sellPrice } = data;

            // Calculate profit based on THB 1000 investment
            const initialInvestmentUSD = THB_INVESTMENT / usdToThbRate;
            const amountBought = initialInvestmentUSD / buyPrice;

            const totalFeeUSD = (amountBought * buyPrice * binanceFeeRate) + (amountBought * sellPrice * binanceFeeRate);
            const grossProfitUSD = (amountBought * sellPrice) - (amountBought * buyPrice);
            const netProfitUSD = grossProfitUSD - totalFeeUSD;
            const netProfitTHB = netProfitUSD * usdToThbRate;

            const profitPercentage = (netProfitUSD / initialInvestmentUSD) * 100;

            // Calculate chance to buy/sell based on current price proximity to support/resistance
            let buyChance, sellChance;
            const priceRange = resistance - support;
            if (priceRange > 0) {
                const distToSupport = currentPrice - support;
                const distToResistance = resistance - currentPrice;
                buyChance = (1 - (distToSupport / priceRange)) * 100;
                sellChance = (1 - (distToResistance / priceRange)) * 100;
                buyChance = Math.min(100, Math.max(0, buyChance));
                sellChance = Math.min(100, Math.max(0, sellChance));
            } else {
                buyChance = 0;
                sellChance = 0;
            }

            // Generate a summary based on the simulated analysis
            let analysisSummary = ``;
            if (macdStatus === 'Bullish' && rsi < 70) {
                 analysisSummary = `สัญญาณ MACD และ RSI บ่งชี้ว่าโมเมนตัมกำลังเป็นขาขึ้น แนวรับอยู่ที่ประมาณ $${support.toFixed(2)} และแนวต้านอยู่ที่ประมาณ $${resistance.toFixed(2)}`
            } else if (macdStatus === 'Bearish' && rsi > 70) {
                 analysisSummary = `ระวัง! ตลาดเริ่มมีสัญญาณหมี (MACD) และเข้าสู่ภาวะซื้อมากเกินไป (RSI) แนวรับถัดไปอาจอยู่ที่ $${support.toFixed(2)}`
            } else {
                 analysisSummary = `ตลาดอยู่ในช่วง sideway สัญญาณยังไม่ชัดเจน แนวรับอยู่ที่ $${support.toFixed(2)} และแนวต้านอยู่ที่ $${resistance.toFixed(2)}`
            }
            
            // Update the UI
            const buyPriceElement = document.getElementById('buy-price');
            const sellPriceElement = document.getElementById('sell-price');
            const supportPriceElement = document.getElementById('support-price');
            const resistancePriceElement = document.getElementById('resistance-price');
            const netProfitUsdElement = document.getElementById('net-profit-usd');
            const netProfitThbElement = document.getElementById('net-profit-thb');
            const buyChanceElement = document.getElementById('buy-chance');
            const sellChanceElement = document.getElementById('sell-chance');
            const analysisSummaryElement = document.getElementById('analysis-summary');

            if (supportPriceElement) {
                supportPriceElement.textContent = `$${support.toFixed(4)}`;
            }
            if (resistancePriceElement) {
                resistancePriceElement.textContent = `$${resistance.toFixed(4)}`;
            }
            if (buyPriceElement) {
                buyPriceElement.textContent = `$${buyPrice.toFixed(4)}`;
            }
            if (sellPriceElement) {
                sellPriceElement.textContent = `$${sellPrice.toFixed(4)}`;
            }
            if (netProfitUsdElement) {
                netProfitUsdElement.textContent = `${netProfitUSD.toFixed(4)}`;
                netProfitUsdElement.className = `font-bold ${netProfitUSD >= 0 ? 'profit-text' : 'loss-text'}`;
            }
            if (netProfitThbElement) {
                netProfitThbElement.textContent = `฿${netProfitTHB.toFixed(2)}`;
                netProfitThbElement.className = `font-bold ${netProfitTHB >= 0 ? 'profit-text' : 'loss-text'}`;
            }
            if (buyChanceElement) {
                buyChanceElement.textContent = `โอกาสเข้าซื้อ: ${buyChance.toFixed(0)}%`;
            }
            if (sellChanceElement) {
                sellChanceElement.textContent = `โอกาสขายทำกำไร: ${sellChance.toFixed(0)}%`;
            }
            if (analysisSummaryElement) {
                analysisSummaryElement.textContent = analysisSummary;
            }
        }

        // Helper function to get random elements from an array
        function getRandomElements(arr, num) {
            const shuffled = [...arr].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, num);
        }
        
        // Fetch exchange rate on page load
        document.addEventListener('DOMContentLoaded', fetchExchangeRate);
    </script>
</body>
</html>
